{% extends "base.html" %}

{% block title %}Quizzes & Lessons - Security+ Exam Prep{% endblock %}

{% block content %}
<div class="quizzes-container">
    <div class="quizzes-header">
        <div class="container">
            <div class="header-content">
                <div class="breadcrumb">
                    <a href="{{ url_for('home') }}">Home</a>
                    <i class="fas fa-chevron-right"></i>
                    <span>Quizzes & Lessons</span>
                </div>
                <h1>Security+ Quizzes & Lessons</h1>
                <p>Practice with scenario-based questions organized by Professor Messer's study materials</p>
            </div>
        </div>
    </div>

    <div class="quizzes-main">
        <div class="container">
            <div class="quiz-header">
                <h2>Security+ Study Sections</h2>
                <p>Select a section to start practicing with questions organized by CompTIA Security+ SY0-701 exam domains</p>
            </div>

            <div class="chapters-grid" id="sections-grid">
                <!-- Sections will be loaded dynamically -->
                <div class="loading-message">
                    <i class="fas fa-spinner fa-spin"></i>
                    Loading sections...
                </div>
            </div>

            <div class="quiz-actions">
                <button class="btn btn-outline btn-large" id="random-quiz">
                    <i class="fas fa-random"></i>
                    Random Quiz (All Sections)
                </button>
                <button class="btn btn-primary btn-large" id="practice-test">
                    <i class="fas fa-clipboard-check"></i>
                    Full Practice Test (90 Questions)
                </button>
            </div>
        </div>
    </div>
</div>


<script>
document.addEventListener('DOMContentLoaded', function() {
    const sectionsGrid = document.getElementById('sections-grid');
    const randomQuizBtn = document.getElementById('random-quiz');
    const practiceTestBtn = document.getElementById('practice-test');
    
    // Load sections from API
    loadSections();
    
    // Random quiz button
    randomQuizBtn.addEventListener('click', function() {
        startRandomQuiz();
    });
    
    // Practice test button
    practiceTestBtn.addEventListener('click', function() {
        startPracticeTest();
    });
    
    function loadSections() {
        fetch('/api/quiz/sections')
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    displaySections(data.sections);
                } else {
                    showError('Failed to load sections: ' + data.error);
                }
            })
            .catch(error => {
                console.error('Error loading sections:', error);
                showError('Failed to load sections. Please try again.');
            });
    }
    
    function displaySections(sections) {
        sectionsGrid.innerHTML = '';
        
        sections.forEach(section => {
            const sectionCard = createSectionCard(section);
            sectionsGrid.appendChild(sectionCard);
        });
    }
    
    function createSectionCard(section) {
        const card = document.createElement('div');
        card.className = 'chapter-card';
        card.dataset.section = section.section_number;
        
        // Calculate exam percentage based on question count
        const examPercentages = [20, 30, 20, 20, 10]; // Based on SY0-701 exam domains
        const examPercentage = examPercentages[section.section_number - 1] || 20;
        
        card.innerHTML = `
            <div class="chapter-number">${section.section_number}</div>
            <div class="chapter-content">
                <h3>${section.name}</h3>
                <p>${section.description}</p>
                <div class="chapter-stats">
                    <span class="exam-percentage">${examPercentage}% of exam</span>
                    <span class="section-count">${section.categories.length} categories</span>
                    <span class="question-count">${section.total_questions} questions</span>
                </div>
                <button class="btn btn-primary start-section" data-section="${section.section_number}">
                    Start Section ${section.section_number}
                </button>
            </div>
        `;
        
        // Add click handlers
        card.addEventListener('click', function(e) {
            if (e.target.classList.contains('btn')) return;
            startSectionQuiz(section.section_number);
        });
        
        const startBtn = card.querySelector('.start-section');
        startBtn.addEventListener('click', function(e) {
            e.stopPropagation();
            startSectionQuiz(section.section_number);
        });
        
        return card;
    }
    
    function startSectionQuiz(section) {
        console.log(`Starting quiz for Section ${section}`);
        window.location.href = `/quiz/section/${section}`;
    }
    
    function startRandomQuiz() {
        console.log('Starting random quiz from all sections');
        window.location.href = '/quiz/random';
    }
    
    function startPracticeTest() {
        console.log('Starting full practice test');
        window.location.href = '/quiz/practice-test';
    }
    
    function showError(message) {
        sectionsGrid.innerHTML = `
            <div class="error-message">
                <i class="fas fa-exclamation-triangle"></i>
                <p>${message}</p>
                <button class="btn btn-primary" onclick="location.reload()">
                    Try Again
                </button>
            </div>
        `;
    }
});
</script>
{% endblock %}
