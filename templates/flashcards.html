{% extends "base.html" %}

{% block title %}Flashcards - Security+ Exam Prep{% endblock %}

{% block content %}
<div class="flashcards-container">
    <div class="flashcards-header">
        <div class="container">
            <div class="header-content">
                <div class="breadcrumb">
                    <a href="{{ url_for('home') }}">Home</a>
                    <i class="fas fa-chevron-right"></i>
                    <span>Flashcards</span>
                </div>
                <h1>Security+ Flashcards</h1>
                <p>Memorize key terms and concepts with interactive flashcards</p>
            </div>
        </div>
    </div>

    <div class="flashcards-main">
        <div class="container">
            <div class="flashcard-header">
                <h2>Security+ Study Sections</h2>
                <p>Select a section to start practicing with flashcards organized by CompTIA Security+ SY0-701 exam domains</p>
            </div>

            <div class="sections-grid" id="sections-grid">
                <!-- Sections will be loaded dynamically -->
                <div class="loading-message">
                    <i class="fas fa-spinner fa-spin"></i>
                    Loading sections...
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const sectionsGrid = document.getElementById('sections-grid');
    
    // Load sections from API
    loadSections();
    
    function loadSections() {
        fetch('/api/flashcards/sections')
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    displaySections(data.sections);
                } else {
                    showError('Failed to load sections: ' + data.error);
                }
            })
            .catch(error => {
                console.error('Error loading sections:', error);
                showError('Failed to load sections. Please try again.');
            });
    }
    
    function displaySections(sections) {
        sectionsGrid.innerHTML = '';
        
        sections.forEach(section => {
            const sectionCard = createSectionCard(section);
            sectionsGrid.appendChild(sectionCard);
        });
    }
    
    function createSectionCard(section) {
        const card = document.createElement('div');
        card.className = 'section-card';
        card.dataset.section = section.section_number;
        
        // Calculate exam percentage based on question count
        const examPercentages = [20, 30, 20, 20, 10]; // Based on SY0-701 exam domains
        const examPercentage = examPercentages[section.section_number - 1] || 20;
        
        card.innerHTML = `
            <div class="section-number">${section.section_number}</div>
            <div class="section-content">
                <h3>${section.name}</h3>
                <p>${section.description}</p>
                <div class="section-stats">
                    <span class="exam-percentage">${examPercentage}% of exam</span>
                    <span class="section-count">${section.categories.length} categories</span>
                    <span class="card-count">${section.total_cards} cards</span>
                </div>
                <button class="btn btn-primary start-section" data-section="${section.section_number}">
                    Start Section ${section.section_number}
                </button>
            </div>
        `;
        
        // Add click handlers
        card.addEventListener('click', function(e) {
            if (e.target.classList.contains('btn')) return;
            startSectionFlashcards(section.section_number);
        });
        
        const startBtn = card.querySelector('.start-section');
        startBtn.addEventListener('click', function(e) {
            e.stopPropagation();
            startSectionFlashcards(section.section_number);
        });
        
        return card;
    }
    
    function startSectionFlashcards(section) {
        console.log(`Starting flashcards for Section ${section}`);
        window.location.href = `/flashcards/section/${section}`;
    }
    
    function showError(message) {
        sectionsGrid.innerHTML = `
            <div class="error-message">
                <i class="fas fa-exclamation-triangle"></i>
                <p>${message}</p>
                <button class="btn btn-primary" onclick="location.reload()">
                    Try Again
                </button>
            </div>
        `;
    }
});
</script>
{% endblock %}
